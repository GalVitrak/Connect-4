#include <stdio.h>
#include <stdlib.h>

#ifdef _WIN32
#include <windows.h>
#endif

#define ROWS 6
#define COLS 7

// enumeration for the state of each cell in the board
typedef enum {
	cell_empty = 0,
	cell_player1,
	cell_player2
} Cell;

// the game board, a 2D array of Cells
static Cell board[ROWS][COLS];
	
// initialize the board to be empty
void board_init(void) {
	for (int r = 0; r < ROWS; r++) {
		for (int c = 0; c < COLS; c++) {
			board[r][c] = cell_empty;
		}
	}
}

#ifdef _WIN32
static void enable_ansi_colors_once(void)
{
	static int tried = 0;
	if (tried) return;
	tried = 1;

	HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);
	if (hOut == INVALID_HANDLE_VALUE) return;

	DWORD mode = 0;
	if (!GetConsoleMode(hOut, &mode)) return;

	// Enable virtual terminal processing so ANSI escape codes work on Windows consoles
	mode |= ENABLE_VIRTUAL_TERMINAL_PROCESSING;
	SetConsoleMode(hOut, mode);
}
#else
static void enable_ansi_colors_once(void) { /* no-op on POSIX */ }
#endif

// Print the board using plain ASCII box characters and ANSI colors for pieces
// Empty cells are shown as light gray '.'; player 1's pieces as red 'X', player 2's pieces as yellow 'O'
void board_print(void) {
	enable_ansi_colors_once();

	const char* col_red = "\x1b[31m";    // ANSI escape code for red
	const char* col_yellow = "\x1b[33m"; // ANSI escape code for yellow
	const char* col_gray = "\x1b[90m";   // ANSI escape code for light gray
	const char* col_reset = "\x1b[0m";   // ANSI escape code to reset color
	 
	// Column headers (1-based display)
	printf("   ");
	for (int c = 1; c <= COLS; ++c) {
		printf(" %d ", c);
	}
	printf("\n");

	// Top border (ASCII)
	printf("  +");
	for (int c = 0; c < COLS; ++c) {
		printf("---+");
	}
	printf("\n");

	for (int r = 0; r < ROWS; ++r) {
		// Row with cells (display rows as 1-based)
		printf("%2d |", r + 1);
		for (int c = 0; c < COLS; ++c) {
			Cell v = board[r][c];
			if (v == cell_player1) {
				printf(" %sX%s |", col_red, col_reset);
			} else if (v == cell_player2) {
				printf(" %sO%s |", col_yellow, col_reset);
			} else {
				printf(" %s.%s |", col_gray, col_reset);
			}
		}
		printf("\n");

		// Row separator / bottom border
		printf("  +");
		for (int c = 0; c < COLS; ++c) {
			printf("---+");
		}
		printf("\n");
	}
}