#include "board.h"
#include "input.h"
#include "game.h"
#include "menu.h"
#include "ai.h"
#include "stats.h"
#include <stdio.h>

void game_init_pvp(void) {
	int running = 1;
	count_game_pvp();
	int count_moves = 0;
	int turn = 0;
	int winner = 0;
	GameMove move;
	Cell player;
	while (running) {
		if (count_moves == BOARD_FULL) {
			print_centered("It's a Draw!");
			running = press_enter_to_proceed();
			clear_console();
			break;
		}
		if (turn == 0) {
			print_centered("Player 1's turn (Red)");
			player = cell_player1;
			turn = 1;
		} else {
			print_centered("Player 2's turn (Yellow)");
			player = cell_player2;
			turn = 0;
		}
		move = input_player_move();
		board[move.row][move.column] = player;
		clear_console();
		board_print();
		count_moves++;
		if (count_moves > 6) {
			winner = check_winner(move, player);
			if(winner == 1){
				if (player == cell_player1) {
					print_centered("🎉 Player 1 (Red) wins! 🎉");
					player_1_win_pvp();
				} else {
					print_centered("🎉 Player 2 (Yellow) wins! 🎉");
					player_2_win_pvp();
				}
				running = press_enter_to_proceed();
				clear_console();
				break;
			}
		}
	}
}

void game_init_easy(void) {
	int running = 1;
	count_game_easy();
	int count_moves = 0;
	int turn = 0;
	int winner = 0;
	Cell player;
	GameMove move;
	while (running) {
		if (count_moves == BOARD_FULL) {
			print_centered("It's a Draw!");
			running = press_enter_to_proceed();
			clear_console();
			break;
		}
		if (turn == 0) {
			print_centered("Player 1's turn (Red)");
			player = cell_player1;
			move = input_player_move();
			turn = 1;
		}
		else {
			print_centered("Computer is thinking...");
			player = cell_player2;
			move = ai_easy_move();
			turn = 0;
		}
		board[move.row][move.column] = player;
		clear_console();
		board_print();
		count_moves++;
		if (count_moves > 6) {
			winner = check_winner(move, player);
			if (winner == 1) {
				if (player == cell_player1) {
					print_centered("🎉 Player (Red) wins! 🎉");
					player_1_win_easy();
				}
				else {
					print_centered("💻 Computer Won! Better luck next time! 💻");
					pc_win_easy();
				}
				running = press_enter_to_proceed();
				clear_console();
				break;
			}
		}
	}
}

void game_init_medium(void) {
	int running = 1;
	count_game_medium();
	int count_moves = 0;
	int turn = 0;
	int winner = 0;
	Cell player;
	GameMove move;
	while (running) {
		if (count_moves == BOARD_FULL) {
			print_centered("It's a Draw!");
			running = press_enter_to_proceed();
			clear_console();
			break;
		}
		if (turn == 0) {
			print_centered("Player 1's turn (Red)");
			player = cell_player1;
			move = input_player_move();
			turn = 1;
		}
		else {
			print_centered("Computer is thinking...");
			player = cell_player2;
			move = ai_medium_move();
			turn = 0;
		}
		board[move.row][move.column] = player;
		clear_console();
		board_print();
		count_moves++;
		if (count_moves > 6) {
			winner = check_winner(move, player);
			if (winner == 1) {
				if (player == cell_player1) {
					print_centered("🎉 Player 1 (Red) wins! 🎉");
					player_1_win_medium();
				}
				else {
					print_centered("💻 Computer Won! Better luck next time! 💻");
					pc_win_medium();
				}
				running = press_enter_to_proceed();
				clear_console();
				break;
			}
		}
	}
}

void game_init_hard(void) {
	int running = 1;
	count_game_hard();
	int count_moves = 0;
	int turn = 0;
	int winner = 0;
	Cell player;
	GameMove move;
	while (running) {
		if (count_moves == BOARD_FULL) {
			print_centered("It's a Draw!");
			running = press_enter_to_proceed();
			clear_console();
			break;
		}
		if (turn == 0) {
			print_centered("Player 1's turn (Red)");
			player = cell_player1;
			move = input_player_move();
			turn = 1;
		}
		else {
			print_centered("💻 Computer is thinking hard... 💻");
			player = cell_player2;
			move = ai_hard_move();
			turn = 0;
		}
		board[move.row][move.column] = player;
		clear_console();
		board_print();
		count_moves++;
		if (count_moves > 6) {
			winner = check_winner(move, player);
			if (winner == 1) {
				if (player == cell_player1) {
					print_centered("🏆 AMAZING! You beat the Hard AI! 🏆");
					player_1_win_hard();
				}
				else {
					print_centered("💻 Computer Won! The AI is too strong! 💻");
					pc_win_hard();
				}
				running = press_enter_to_proceed();
				clear_console();
				break;
			}
		}
	}
}

int check_vertical(GameMove last_move, Cell player) {
	int temp_row, temp_col;
	temp_col = last_move.column;
	temp_row = last_move.row;
	int count = 1;
	while (temp_row + 1 < ROWS && board[temp_row + 1][temp_col] == player && count < WIN_COUNT) {
		count++;
		temp_row++;
	}
	if (count == WIN_COUNT) {
		return 1;
	}
	else {
		count = 1;
		while (temp_row - 1 >= 0 && board[temp_row - 1][temp_col] == player && count < WIN_COUNT) {
			count++;
			temp_row--;
		}
	}
	if (count == WIN_COUNT) {
		return 1;
	} else {
		return 0;
	}
}

int check_horizontal(GameMove last_move, Cell player) {
	int temp_row, temp_col;
	temp_col = last_move.column;
	temp_row = last_move.row;
	int count = 1;
	while (temp_col + 1 < COLS && board[temp_row][temp_col + 1] == player && count < WIN_COUNT) {
		count++;
		temp_col++;
	}
	if (count == WIN_COUNT) {
		return 1;
	}
	else {
		count = 1;
		while (temp_col - 1 >= 0 && board[temp_row][temp_col - 1] == player && count < WIN_COUNT) {
			count++;
			temp_col--;
		}
		if (count == WIN_COUNT) {
			return 1;
		}
		else {
			return 0;
		}
	}
}

int check_diagonal(GameMove last_move, Cell player) {
	int temp_row, temp_col;
	temp_col = last_move.column;
	temp_row = last_move.row;
	int count = 1;
	while (temp_row + 1 < ROWS && temp_col + 1 < COLS && board[temp_row + 1][temp_col + 1] == player && count < WIN_COUNT) {
		count++;
		temp_row++;
		temp_col++;
	}
	if (count == WIN_COUNT) {
		return 1;
	}else{
		count = 1;
		while (temp_row - 1 >= 0 && temp_col - 1 >= 0 && board[temp_row - 1][temp_col - 1] == player && count < WIN_COUNT) {
			count++;
			temp_row--;
			temp_col--;
		}
	}
	if(count == WIN_COUNT){
		return 1;
	}
	else {
		count = 1;
		while (temp_row + 1 < ROWS && temp_col - 1 >= 0 && board[temp_row + 1][temp_col - 1] == player && count < WIN_COUNT) {
			count++;
			temp_row++;
			temp_col--;
		}
	}
	if (count == WIN_COUNT){
		return 1;
	}
	else {
		count = 1;
		while (temp_row - 1 >= 0 && temp_col + 1 < COLS && board[temp_row - 1][temp_col + 1] == player && count < WIN_COUNT) {
			count++;
			temp_row--;
			temp_col++;
		}
	}
	if (count == WIN_COUNT) {
		return 1;
	}
return 0;
}

int check_winner(GameMove last_move, Cell player) {
	int result = 0;
	result = check_vertical(last_move, player);
	if(result == 1) {
		return 1;
	}
	result = check_horizontal(last_move, player);
	if (result == 1) {
		return 1;
	}
	result = check_diagonal(last_move, player);
	if (result == 1) {
		return 1;
	}
	return 0;
}